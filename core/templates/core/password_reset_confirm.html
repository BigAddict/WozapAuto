{% extends 'core/base.html' %}
{% load static %}

{% block title %}Reset Password - WozapAuto{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-6 col-md-8">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">
                        <i class="bi bi-shield-lock me-2"></i>Reset Your Password
                    </h4>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-4">
                        Create a strong password to secure your account.
                    </p>
                    
                    <form method="post">
                        {% csrf_token %}
                        
                        {% if form.errors %}
                            <div class="alert alert-danger">
                                <ul class="mb-0">
                                    {% for field, errors in form.errors.items %}
                                        {% for error in errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endif %}
                        
                        <div class="mb-3">
                            <label for="{{ form.new_password1.id_for_label }}" class="form-label">New Password</label>
                            <div class="position-relative">
                                {{ form.new_password1 }}
                                <button type="button" class="btn btn-sm btn-outline-secondary toggle-password" data-target-id="{{ form.new_password1.id_for_label }}" aria-label="Show password">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                            <div class="password-strength mt-3">
                                <div class="progress" style="height: 6px;">
                                    <div id="pwStrengthBar" class="progress-bar bg-danger" style="width: 0%"></div>
                                </div>
                                <small id="pwStrengthText" class="text-muted">Strength: Too weak</small>
                            </div>
                            <ul class="password-checklist small mt-2 list-unstyled">
                                <li id="req-length" class="text-muted"><i class="bi bi-circle me-1"></i> At least 8 characters</li>
                                <li id="req-upper" class="text-muted"><i class="bi bi-circle me-1"></i> Contains an uppercase letter</li>
                                <li id="req-lower" class="text-muted"><i class="bi bi-circle me-1"></i> Contains a lowercase letter</li>
                                <li id="req-number" class="text-muted"><i class="bi bi-circle me-1"></i> Contains a number</li>
                                <li id="req-special" class="text-muted"><i class="bi bi-circle me-1"></i> Contains a special character</li>
                            </ul>
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.new_password2.id_for_label }}" class="form-label">Confirm New Password</label>
                            <div class="position-relative">
                                {{ form.new_password2 }}
                                <button type="button" class="btn btn-sm btn-outline-secondary toggle-password" data-target-id="{{ form.new_password2.id_for_label }}" aria-label="Show password">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                            <small id="pwMatchText" class="text-muted d-block mt-2">Passwords must match</small>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button id="submitBtn" type="submit" class="btn btn-primary" disabled>
                                <i class="bi bi-check-circle me-2"></i>Reset Password
                            </button>
                        </div>
                    </form>
                    
                    <div class="text-center mt-4">
                        <p class="text-muted">
                            Remember your password? 
                            <a href="{% url 'signin' %}" class="text-decoration-none">Sign In</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.form-control {
    border-radius: 8px;
    border: 1px solid #ddd;
    padding: 12px 15px;
    font-size: 16px;
    transition: all 0.3s ease;
}

.form-control:focus {
    border-color: #25D366;
    box-shadow: 0 0 0 0.2rem rgba(37, 211, 102, 0.25);
}

.btn-primary {
    background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
    border: none;
    border-radius: 8px;
    padding: 12px 24px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(37, 211, 102, 0.3);
}

.toggle-password {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
}

.password-checklist li.valid { color: #28a745; }

.card { border-radius: 12px; overflow: hidden; }
.card-header { background: #128C7E; color: #fff; }
</style>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const pw1 = document.getElementById('{{ form.new_password1.id_for_label }}');
    const pw2 = document.getElementById('{{ form.new_password2.id_for_label }}');
    const bar = document.getElementById('pwStrengthBar');
    const text = document.getElementById('pwStrengthText');
    const matchText = document.getElementById('pwMatchText');
    const submitBtn = document.getElementById('submitBtn');

    const reqs = {
        length: document.getElementById('req-length'),
        upper: document.getElementById('req-upper'),
        lower: document.getElementById('req-lower'),
        number: document.getElementById('req-number'),
        special: document.getElementById('req-special')
    };

    function scorePassword(p) {
        let score = 0;
        const checks = {
            length: p.length >= 8,
            upper: /[A-Z]/.test(p),
            lower: /[a-z]/.test(p),
            number: /\d/.test(p),
            special: /[!@#$%^&*(),.?":{}|<>]/.test(p)
        };
        Object.entries(checks).forEach(([k, ok]) => {
            reqs[k].classList.toggle('valid', ok);
            if (ok) score += 20;
        });
        return score;
    }

    function update() {
        const s = scorePassword(pw1.value);
        bar.style.width = s + '%';
        if (s < 40) { bar.className = 'progress-bar bg-danger'; text.textContent = 'Strength: Too weak'; }
        else if (s < 60) { bar.className = 'progress-bar bg-warning'; text.textContent = 'Strength: Weak'; }
        else if (s < 80) { bar.className = 'progress-bar bg-info'; text.textContent = 'Strength: Good'; }
        else { bar.className = 'progress-bar bg-success'; text.textContent = 'Strength: Strong'; }

        const match = pw1.value && pw1.value === pw2.value;
        matchText.textContent = match ? 'Passwords match' : 'Passwords must match';
        matchText.className = 'text-' + (match ? 'success' : 'muted') + ' d-block mt-2';

        submitBtn.disabled = !(s >= 60 && match);
    }

    pw1.addEventListener('input', update);
    pw2.addEventListener('input', update);
    update();

    // Toggle password visibility
    document.querySelectorAll('.toggle-password').forEach(btn => {
        btn.addEventListener('click', () => {
            const id = btn.getAttribute('data-target-id');
            const input = document.getElementById(id);
            if (input) {
                if (input.type === 'password') {
                    input.type = 'text';
                    btn.innerHTML = '<i class="bi bi-eye-slash"></i>';
                } else {
                    input.type = 'password';
                    btn.innerHTML = '<i class="bi bi-eye"></i>';
                }
            }
        });
    });
});
</script>
{% endblock %}
