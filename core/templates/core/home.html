{% extends 'core/base.html' %}
{% load static %}
{# {% load component_tags %} #}

{% block title %}Dashboard - WozapAuto{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    {% if user.is_authenticated %}
    <!-- Authenticated User Dashboard -->
    <div class="dashboard-header">
        <h1 class="dashboard-title">Welcome back, {{ user.first_name|default:user.username }}!</h1>
        <p class="dashboard-subtitle">Your WhatsApp AI Agent Platform Dashboard</p>
    </div>
    
    {% with progress=onboarding_progress %}
    {% if progress %}
    <section class="surface-card surface-card--muted onboarding-panel" role="region" aria-labelledby="onboarding-progress-heading">
        <div class="onboarding-panel__header">
            <div>
                <h2 id="onboarding-progress-heading">Getting set up</h2>
                <p class="onboarding-panel__subtitle">
                    {{ onboarding_steps_completed }} of {{ onboarding_steps_total }} steps complete
                </p>
            </div>
            {% if onboarding_steps_completed == onboarding_steps_total %}
            <span class="onboarding-panel__status" role="status">
                <i class="bi bi-check-circle-fill me-1" aria-hidden="true"></i>All set!
            </span>
            {% endif %}
        </div>
        <ol class="onboarding-panel__list surface-list">
            <li class="surface-list__item onboarding-step {% if progress.profile %}onboarding-step--completed{% endif %}">
                <div class="onboarding-step__indicator" aria-hidden="true">
                    <i class="bi {% if progress.profile %}bi-check-circle-fill{% else %}bi-circle{% endif %}"></i>
                </div>
                <div class="onboarding-step__content">
                    <p class="onboarding-step__title">Set up your personal profile</p>
                    <p class="onboarding-step__description">Add your name and contact details so we can personalize your workspace.</p>
                    {% if progress.profile %}
                        <span class="badge rounded-pill text-bg-success">Complete</span>
                    {% else %}
                        <a class="onboarding-step__action" href="{% url 'profile_edit' %}">Complete profile</a>
                    {% endif %}
                </div>
            </li>
            <li class="surface-list__item onboarding-step {% if progress.business %}onboarding-step--completed{% endif %}">
                <div class="onboarding-step__indicator" aria-hidden="true">
                    <i class="bi {% if progress.business %}bi-check-circle-fill{% else %}bi-circle{% endif %}"></i>
                </div>
                <div class="onboarding-step__content">
                    <p class="onboarding-step__title">Create your business profile</p>
                    <p class="onboarding-step__description">Tell us about your business to unlock products, services, and appointments.</p>
                    {% if progress.business %}
                        <a class="onboarding-step__action" href="{% url 'business:business_detail' %}">View business profile</a>
                    {% else %}
                        <a class="onboarding-step__action" href="{% url 'create_business_profile' %}">Create business profile</a>
                    {% endif %}
                </div>
            </li>
            <li class="surface-list__item onboarding-step {% if progress.connection %}onboarding-step--completed{% endif %}">
                <div class="onboarding-step__indicator" aria-hidden="true">
                    <i class="bi {% if progress.connection %}bi-check-circle-fill{% else %}bi-circle{% endif %}"></i>
                </div>
                <div class="onboarding-step__content">
                    <p class="onboarding-step__title">Connect WhatsApp</p>
                    <p class="onboarding-step__description">Link your WhatsApp account to start sending and receiving messages.</p>
                    {% if progress.connection %}
                        <a class="onboarding-step__action" href="{% url 'connections:qr_display' %}">Manage connection</a>
                    {% else %}
                        <a class="onboarding-step__action" href="{% url 'connections:create' %}">Create connection</a>
                    {% endif %}
                </div>
            </li>
            <li class="surface-list__item onboarding-step {% if progress.knowledge %}onboarding-step--completed{% endif %}">
                <div class="onboarding-step__indicator" aria-hidden="true">
                    <i class="bi {% if progress.knowledge %}bi-check-circle-fill{% else %}bi-circle{% endif %}"></i>
                </div>
                <div class="onboarding-step__content">
                    <p class="onboarding-step__title">Upload knowledge base documents</p>
                    <p class="onboarding-step__description">Help your AI agent answer questions by providing product guides and FAQs.</p>
                    {% if progress.knowledge %}
                        <a class="onboarding-step__action" href="{% url 'knowledgebase:knowledge_base_list' %}">
                            View documents ({{ knowledge_docs_count }})
                        </a>
                    {% else %}
                        <a class="onboarding-step__action" href="{% url 'knowledgebase:knowledge_base_upload' %}">Upload your first document</a>
                    {% endif %}
                </div>
            </li>
        </ol>
    </section>
    {% if onboarding_steps_completed == onboarding_steps_total %}
    <section class="surface-card surface-card--success onboarding-panel onboarding-panel--complete" aria-live="polite">
        <p class="onboarding-panel__complete-message">
            Youâ€™re all set! Jump into any section via the navigation to start managing your WhatsApp automation.
        </p>
    </section>
    {% endif %}
    {% endif %}
    {% endwith %}
    
    {% else %}
    <!-- Landing Page for Unauthenticated Users -->
    <div class="hero-section">
        <div class="container">
            <div class="row align-items-center min-vh-75">
                <div class="col-lg-6">
                    <div class="hero-content">
                        <div class="hero-badge mb-3" data-aos="fade-down">
                            <span class="badge glass px-3 py-2">
                                <i class="bi bi-star-fill me-1"></i>Trusted by 10,000+ businesses
                            </span>
                        </div>
                        <h1 class="hero-title mb-4" data-aos="fade-up" data-aos-delay="200">
                            Transform Your Customer Service with 
                            <span class="text-gradient gradient-text-animated">AI-Powered</span> WhatsApp Agents
                        </h1>
                        <p class="hero-description mb-4" data-aos="fade-up" data-aos-delay="400">
                            Automate customer support, boost response times, and scale your business with intelligent WhatsApp bots that work 24/7.
                        </p>
                        <div class="hero-actions d-flex flex-column flex-sm-row gap-3 mb-3" data-aos="fade-up" data-aos-delay="600">
                            <a href="{% url 'signup' %}" class="btn btn-primary btn-lg px-4 py-3">
                                <i class="bi bi-rocket-takeoff me-2"></i>Start Free Trial
                            </a>
                            <a href="#demo" class="btn btn-outline-primary btn-lg px-4 py-3">
                                <i class="bi bi-play-circle me-2"></i>Watch Demo
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="hero-image" data-aos="fade-left" data-aos-delay="400">
                        <div class="floating-card card-1">
                            <div class="card-header d-flex align-items-center">
                                <div class="avatar me-2">
                                    <i class="bi bi-person-circle"></i>
                                </div>
                                <div>
                                    <h6 class="mb-0">Customer Support</h6>
                                    <small class="text-muted">Online</small>
                                </div>
                            </div>
                            <div class="card-body">
                                <p class="mb-2">Hi! How can I help you today?</p>
                                <div class="message-bubble">
                                    <p class="mb-0">I need help with my order</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="floating-card card-2">
                            <div class="card-header d-flex align-items-center">
                                <div class="avatar me-2">
                                    <i class="bi bi-robot"></i>
                                </div>
                                <div>
                                    <h6 class="mb-0">AI Assistant</h6>
                                    <small class="text-muted">Responding...</small>
                                </div>
                            </div>
                            <div class="card-body">
                                <p class="mb-2">I can help you with that! What's your order number?</p>
                                <div class="typing-indicator">
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                </div>
                            </div>
                        </div>

                        <!-- Stats moved to the side of hero image for better fold fit -->
                        <div class="hero-stats" data-aos="fade-left" data-aos-delay="800">
                            <div class="stat-item">
                                <div class="stat-number">10K+</div>
                                <div class="stat-label">Active Users</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">99.9%</div>
                                <div class="stat-label">Uptime</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">24/7</div>
                                <div class="stat-label">Support</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add click handlers for action cards
    document.querySelectorAll('.action-card').forEach(card => {
        card.addEventListener('click', function() {
            // Add click animation
            this.style.transform = 'scale(0.98)';
            setTimeout(() => {
                this.style.transform = '';
            }, 150);
        });
    });
    
    // Animate stat numbers
    function animateNumbers() {
        document.querySelectorAll('.stat-card__number').forEach(element => {
            const finalNumber = element.textContent;
            const isPercentage = finalNumber.includes('%');
            const isPlus = finalNumber.includes('+');
            const numericValue = parseFloat(finalNumber.replace(/[^\d.]/g, ''));
            
            if (!isNaN(numericValue)) {
                let currentNumber = 0;
                const increment = numericValue / 50;
                const timer = setInterval(() => {
                    currentNumber += increment;
                    if (currentNumber >= numericValue) {
                        currentNumber = numericValue;
                        clearInterval(timer);
                    }
                    
                    let displayNumber = Math.floor(currentNumber);
                    if (isPercentage) displayNumber += '%';
                    if (isPlus) displayNumber = '+' + displayNumber;
                    
                    element.textContent = displayNumber;
                }, 30);
            }
        });
    }
    
    // Start animation when page loads
    setTimeout(animateNumbers, 500);
});
</script>
{% endblock %}